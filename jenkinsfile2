pipeline {
    agent any
    tools {
        maven 'maven' // Ensure correct Maven tool name
    }
    environment {
        TOMCAT_CREDENTIALS_ID = 'tomcat' // Ensure correct credentials ID
    }

    stages {
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }

        stage('Test') {
            steps {
                sh 'mvn test'
            }
        }

        stage('Deploy') {
            steps {
                script {
                    // Deploy to Tomcat using credentials stored in Jenkins
                    withCredentials([usernamePassword(credentialsId: TOMCAT_CREDENTIALS_ID, passwordVariable: 'TOMCAT_PASSWORD', usernameVariable: 'TOMCAT_USERNAME')]) {
                        sh "curl --upload-file ./target/*.war 'http://robot:robot@3.93.58.168:8081/manager/text/deploy?path=/WebAppCal&update=true'"
                    }
                }
            }
        }
    }
}

